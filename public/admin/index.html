<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Magazine CMS</title>
  <!-- Prevent auto-init -->
  <script>window.CMS_MANUAL_INIT = true;</script>
</head>
<body>
  <!-- Mount point -->
  <div id="nc-root"></div>

  <!-- Netlify-CMS bundle -->
  <script src="https://unpkg.com/netlify-cms@^2/dist/netlify-cms.js"></script>

  <!-- Inline CMS config -->
  <script>
    CMS.init({
      config: {
        backend: {
          name: "git-gateway",    // ← use Netlify’s Git Gateway
          branch: "main"          // or your default branch
        },
        publish_mode: "editorial_workflow",  // optional, for previews/approvals
        site_url: "https://bicephale.org",
        logo_url: "/favicon.ico",

        media_folder:   "texts/{{path}}",
        public_folder:  "/texts/{{path}}",

        collections: [
          {
            name: "articles",
            label: "Articles",
            folder: "texts",
            create: true,
            nested: { depth: 2 },       // texts/<category>/<slug>/<slug>.md
            slug:      "{{filename}}",
            extension: "md",
            format:    "frontmatter",

            fields: [
              { name:"title",        label:"Titre",        widget:"string" },
              { name:"author",       label:"Auteur",       widget:"string", default:"Unknown Author" },
              { name:"date",         label:"Date",         widget:"datetime" },
              { name:"header-image", label:"Header Image", widget:"image", required:false },
              {
                name:     "media",
                label:    "Gallery",
                widget:   "list",
                required: false,
                field: {
                  name:  "media",
                  label: "Image",
                  widget:"image"
                }
              },
              { name:"body",         label:"Texte",        widget:"markdown" }
            ]
          }
        ]
      }
    });
  </script>
</body>
</html>
